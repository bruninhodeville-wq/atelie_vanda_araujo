{% extends "base.html" %}

{% block title %}Novo Pedido{% endblock %}

{% block content %}
<div class="container-form">
    <h1>
        {% if pedido_atual %}Editar Pedido #{{ proximo_id }}{% else %}Abrir Novo Pedido #{{ proximo_id }}{% endif %}
    </h1>

    <form action="/pedidos/novo" method="POST" onsubmit="return prepararEnvio()">
        <input type="hidden" name="pedido_id_editar" value="{{ pedido_atual.id if pedido_atual else '' }}">

        <h2>1. Identificar Cliente</h2>
        <div class="row">
            <div class="col" style="flex: 3;">
                <label>Buscar Cliente:</label>
                <input list="clientes_list" id="busca_cliente" placeholder="Digite para buscar..." 
                       value="{{ pedido_atual.cliente.nome if pedido_atual else '' }}" autocomplete="off">
                <datalist id="clientes_list">
                    {% for cliente in clientes %}
                        <option data-id="{{ cliente.id }}" data-telefone="{{ cliente.telefone }}" data-tipo="{{ cliente.tipo_cliente }}" value="{{ cliente.nome }}">
                    {% endfor %}
                </datalist>
                <input type="hidden" name="cliente_id" id="cliente_id_hidden" value="{{ pedido_atual.cliente_id if pedido_atual else '' }}">
            </div>
            <div class="col">
                 <br>
                 <a href="/clientes/novo" style="color: #007bff; font-weight: bold;">+ Cadastrar Novo</a>
            </div>
        </div>
        
        <h2>2. Adicionar Produtos</h2>
        <br><hr><br>
        <button type="submit" style="width: 100%; padding: 15px; background: #28a745; color: white; border: none; font-size: 1.2rem; cursor: pointer;">
            Gerar Pedido
        </button>
    </form>
</div>

<script>
    // ... Cole aqui os scripts JS de carrinho e busca que estavam no novo_pedido.html ...
</script>
{% endblock %}